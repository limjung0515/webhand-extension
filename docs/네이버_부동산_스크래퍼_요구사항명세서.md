
# 네이버 부동산 매물 스크래퍼 - 요구사항 명세서

## 1. 타겟 페이지 URL 패턴

**URL 패턴**: `https://m.land.naver.com/map/*`

**예시**:
```
https://m.land.naver.com/map/37.509011:126.891562:15/APT:ABYG:JGC/A1:B1
```

---

## 2. 데이터 추출 필드 및 파싱 구조

### HTML 구조 (개별 아이템)

```html
<div class="item" data-id="2569056557">
  <a href="/article/info/2569056557" class="thumbnail" style="background-image:url(https://...JPG)"></a>
  
  <div class="info_area">
    <div class="title_area">
        <span class="icon-badge">현장</span>
        <em class="title_place">빌라</em>
    </div>

    <div class="price_area">
        <span class="type">매매</span>
        <strong class="price">3억 9,300</strong>
    </div>

    <div class="information_area">
        <p class="info">
            <strong class="type">빌라</strong>
            <span class="spec">39/29.9㎡, 4/5층, 남동향</span>
        </p>
        <p class="info">
            <span class="spec">독산동 A구역 쓰리룸 신속통합기획</span>
        </p>
    </div>

    <div class="tag_area">
        <em class="tag">4년이내</em>
        <em class="tag">화장실두개</em>
        <em class="tag">소형평수</em>
    </div>

    <div class="cp_area">
        <span class="agent_name">부동산써브 제공</span>
        <span class="agent_name">해성공인중개사사무소</span>
    </div>

    <div class="merit_area">
        <span class="type-confirmed">확인매물 25.12.24.</span>
    </div>
  </div>
</div>
```

### 추출할 데이터 필드

사용자 관점에서 보이는 모든 정보 추출:
- **매물 ID** (`data-id`)
- **썸네일 이미지 URL**
- **아이콘 뱃지** (현장, 등)
- **매물 타입** (빌라, 아파트, 오피스텔 등)
- **거래 유형** (매매, 전세, 월세)
- **가격**
- **면적 정보** (평수/㎡)
- **층수** (예: 4/5층)
- **방향** (남동향 등)
- **상세 설명**
- **태그** (4년이내, 화장실두개 등)
- **중개사 정보**
- **확인매물 날짜**

---

## 3. 매물 목록 표시 방식

- **표시 방식**: 지도 + 리스트 병행 표시
- **페이징**: 별도 페이징 없음
- **로딩 방식**: **무한스크롤** 방식

---

## 4. 스크래핑 방식

### 4.1 매물 목록 노출

현재 페이지의 모든 매물을 스크래핑한다.

- 화면에 리스트가 이미 노출되어 있을 수 있음
- 노출되지 않았다면 **"매물 목록" 버튼 클릭**하여 리스트 노출

```html
<!-- 매물 목록 버튼 -->
<div class="btns_fixed_inner" id="_countContainer">
  <a href="javascript:void(0);" class="btn_option _article" role="button" style="">
    매물 <span class="hidable">목록</span>
    <em class="txt_number _count" style="display: inline;">234+</em>
  </a>
</div>

<!-- 노출된 리스트의 컨테이너 -->
<div id="_listContainer" class="map_fixed_area gpu-render" ...>
```

### 4.2 무한스크롤 처리

리스트가 노출되면:
1. 리스트를 **끝까지 스크롤**
2. 스크롤 시 데이터가 **동적 로딩**되므로 계속 스크래핑
3. 마지막까지 모든 데이터 수집

---

## 5. 스크래핑 완료 조건

다음 조건 중 하나가 충족되면 스크래핑 완료:

1. **정상 완료**: 스크래핑한 데이터 개수 == 전체 매물 개수 (버튼에 표시된 `_count`)
2. **타임아웃 완료**: 스크롤을 끝까지 내렸는데 **일정 시간 동안** 더 이상 새로운 아이템이 로드되지 않을 때

---

## 6. 데이터 저장 형식 & 출력

- **결과 페이지**: 기존 WebHand 확장 프로그램의 **결과 페이지 템플릿 활용**
- **변경 사항**: 테이블 구조만 네이버 부동산 데이터에 맞게 수정
- **동작**: 스크래핑 완료 시 결과 페이지 자동 생성 및 표시

---

## 7. UI/UX 요구사항

### 7.1 스크래핑 시작 방법
- 기존과 동일하게 **"스크래핑 시작" 버튼** 클릭

### 7.2 진행 상황 표시
- **전체 매물 수** 표시
- **진행률** 표시 (예: "234개 중 100개 수집")
- 수집 중인 매물 정보 실시간 업데이트

### 7.3 컨트롤 버튼
- 시작, 일시정지, 중지, 재개 (필요시)

---

## 8. 성능 & 안전 설정

### 8.1 스크롤 딜레이
- **초기 설정**: 안전한 속도로 설정 (봇 감지 회피)
- **조정 가능**: 테스트 후 속도 조정 가능하도록 구현

### 8.2 메모리 관리
- 필요시 대량 데이터 처리를 위한 최적화

---

## 9. 에러 처리

자동으로 다음 상황 처리:
- 네트워크 오류 시 재시도 로직
- 페이지 구조 변경 감지
- 스크래핑 실패 시 사용자 알림
- 예외 상황 로깅

---

## 10. 중복 제거

- **중복 기준**: `data-id` 속성 값
- **처리 방식**: 동일한 `data-id`를 가진 매물은 한 번만 수집

---

## 11. 필터링 기능

- **필터링 주체**: 사용자가 네이버 부동산 지도에서 직접 필터링
- **스크래퍼 역할**: 최종적으로 **화면에 표시된 리스트만 단순 스크래핑**
- 별도의 가격대, 매물 타입 필터링 기능은 구현하지 않음

---

## 개발 우선순위

1. ✅ 기본 스크래핑 로직 구현
2. ✅ 무한스크롤 처리
3. ✅ 진행률 표시
4. ✅ 중복 제거
5. ✅ 결과 페이지 생성
6. ✅ 에러 처리
7. ✅ 성능 최적화

---

## 추가 고려사항

- 네이버 부동산 페이지 구조 변경에 대한 대응 방안
- Rate limiting 회피 전략
- 사용자 경험 최적화 (로딩 애니메이션, 진행바 등)